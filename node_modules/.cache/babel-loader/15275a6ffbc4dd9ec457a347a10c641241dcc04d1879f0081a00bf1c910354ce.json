{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useContext, useEffect, useCallback } from \"react\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport { AuthContext } from \"../contexts/AuthContext\";\nimport { api } from \"../utils/api\";\nimport { login as loginConfig, signup as signupConfig } from \"../utils/auth\";\nexport const useAuth = toggleModal => {\n  _s();\n  const {\n    setIsLoggedIn\n  } = useContext(AuthContext);\n  const {\n    setCurrentUser\n  } = useContext(CurrentUserContext);\n  const [response, setResponse] = useState(\"\");\n  const handleLogIn = async ({\n    email,\n    password\n  }) => {\n    const config = loginConfig(email, password);\n    try {\n      const res = await api(\"POST\", \"/login\", \"\", config);\n\n      // Check if the response contains a token\n      if (res.token) {\n        localStorage.setItem(\"jwt\", res.token);\n        setIsLoggedIn(true);\n\n        // Fetch user info and update current user\n        const userInfo = await fetchUserInfo(res.token);\n        setCurrentUser(userInfo);\n        toggleModal(\"login\");\n      } else {\n        console.error(res.message);\n        setResponse(res.message || \"Log in failed\");\n      }\n    } catch (error) {\n      console.error(\"Error during login:\", error);\n    }\n  };\n  const handleSignUp = async ({\n    name,\n    avatar,\n    email,\n    password\n  }) => {\n    const config = signupConfig(name, avatar, email, password);\n    try {\n      const res = await api(\"POST\", \"/signup\", \"\", config);\n\n      // Check if the response is successful\n      if (res.data) {\n        // SignUp successful, proceed to login\n        await handleLogIn({\n          email,\n          password\n        });\n        toggleModal(\"signup\");\n      } else {\n        console.error(res.message);\n        setResponse(res.message || \"Sign up failed\");\n      }\n    } catch (error) {\n      console.error(\"Error during sign up:\", error);\n    }\n  };\n  const handleLogout = () => {\n    localStorage.removeItem(\"jwt\");\n    setIsLoggedIn(false);\n    setCurrentUser(null);\n    setCurrentUser({\n      avatar: \"T T\"\n    });\n    toggleModal(\"logout\");\n  };\n  const fetchUserInfo = useCallback(async token => {\n    try {\n      const response = await api(\"GET\", \"/me\", token); // changed to /user/me ?\n      if (response.ok) {\n        const userInfo = await response.json();\n        console.log(\"User Info:\", userInfo);\n        setCurrentUser(userInfo);\n        return userInfo;\n      } else {\n        console.error(`Can't access user. Error: ${response.status}`);\n        return null;\n      }\n    } catch (error) {\n      console.error(\"Error fetching user info:\", error);\n      return null;\n    }\n  }, [setCurrentUser]);\n  useEffect(() => {\n    const token = localStorage.getItem(\"jwt\");\n    if (token) {\n      setIsLoggedIn(true);\n      fetchUserInfo(token);\n    }\n  }, [fetchUserInfo, setIsLoggedIn]);\n  return {\n    handleLogIn,\n    handleSignUp,\n    handleLogout,\n    response\n  };\n};\n_s(useAuth, \"Qg8+tDl8WDsz7viMGsR60Z6nik4=\");\nexport default useAuth;","map":{"version":3,"names":["useState","useContext","useEffect","useCallback","CurrentUserContext","AuthContext","api","login","loginConfig","signup","signupConfig","useAuth","toggleModal","_s","setIsLoggedIn","setCurrentUser","response","setResponse","handleLogIn","email","password","config","res","token","localStorage","setItem","userInfo","fetchUserInfo","console","error","message","handleSignUp","name","avatar","data","handleLogout","removeItem","ok","json","log","status","getItem"],"sources":["/Users/michaelabudde/practicum/fullstack/se_project_react/src/hooks/useAuth.js"],"sourcesContent":["import { useState, useContext, useEffect, useCallback } from \"react\";\nimport { CurrentUserContext } from \"../contexts/CurrentUserContext\";\nimport { AuthContext } from \"../contexts/AuthContext\";\nimport { api } from \"../utils/api\";\nimport { login as loginConfig, signup as signupConfig } from \"../utils/auth\";\n\nexport const useAuth = (toggleModal) => {\n  const { setIsLoggedIn } = useContext(AuthContext);\n  const { setCurrentUser } = useContext(CurrentUserContext);\n  const [response, setResponse] = useState(\"\");\n\n  const handleLogIn = async ({ email, password }) => {\n    const config = loginConfig(email, password);\n    try {\n      const res = await api(\"POST\", \"/login\", \"\", config);\n\n      // Check if the response contains a token\n      if (res.token) {\n        localStorage.setItem(\"jwt\", res.token);\n        setIsLoggedIn(true);\n\n        // Fetch user info and update current user\n        const userInfo = await fetchUserInfo(res.token);\n        setCurrentUser(userInfo);\n\n        toggleModal(\"login\");\n      } else {\n        console.error(res.message);\n        setResponse(res.message || \"Log in failed\");\n      }\n    } catch (error) {\n      console.error(\"Error during login:\", error);\n    }\n  };\n\n  const handleSignUp = async ({ name, avatar, email, password }) => {\n    const config = signupConfig(name, avatar, email, password);\n    try {\n      const res = await api(\"POST\", \"/signup\", \"\", config);\n\n      // Check if the response is successful\n      if (res.data) {\n        // SignUp successful, proceed to login\n        await handleLogIn({ email, password });\n        toggleModal(\"signup\");\n      } else {\n        console.error(res.message);\n        setResponse(res.message || \"Sign up failed\");\n      }\n    } catch (error) {\n      console.error(\"Error during sign up:\", error);\n    }\n  };\n\n  const handleLogout = () => {\n    localStorage.removeItem(\"jwt\");\n    setIsLoggedIn(false);\n    setCurrentUser(null);\n    setCurrentUser({ avatar: \"T T\" });\n    toggleModal(\"logout\");\n  };\n\n  const fetchUserInfo = useCallback(\n    async (token) => {\n      try {\n        const response = await api(\"GET\", \"/me\", token); // changed to /user/me ?\n        if (response.ok) {\n          const userInfo = await response.json();\n          console.log(\"User Info:\", userInfo);\n          setCurrentUser(userInfo);\n          return userInfo;\n        } else {\n          console.error(`Can't access user. Error: ${response.status}`);\n          return null;\n        }\n      } catch (error) {\n        console.error(\"Error fetching user info:\", error);\n        return null;\n      }\n    },\n    [setCurrentUser]\n  );\n\n  useEffect(() => {\n    const token = localStorage.getItem(\"jwt\");\n    if (token) {\n      setIsLoggedIn(true);\n      fetchUserInfo(token);\n    }\n  }, [fetchUserInfo, setIsLoggedIn]);\n\n  return { handleLogIn, handleSignUp, handleLogout, response };\n};\n\nexport default useAuth;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}